# Результаты проверки маркетинговых полей

## Коротко (если нужно быстро понять состояние)
- **Что уже есть:** стандартные поля `SOURCE_ID` и `UTM_*`, черновой список значений для `UF_CRM_CONTACT_METHOD`, большинство черновых роботов.
- **Чего не хватает:** создать несколько пользовательских полей из чек-листа (тип клиента, ответственный за канал, домен посадки), а также актуализировать значения контакт-метода.
- **Что проверить:** веб-формы и UIS должны писать в стандартные поля; мессенджеры — в `UF_CRM_CONTACT_METHOD`.
- **Зачем всё это:** закрываем аудит, чтобы запустить выбранную гипотезу (из README) без сюрпризов.

## 1. Статус целевых полей
| Поле | Целевое состояние | Текущее состояние по данным аудита | Гэп / действие |
| --- | --- | --- | --- |
| `UF_CRM_UTM_MEDIUM` (list) | Нормализованный список `cpc/organic/referral/social/email/direct/offline/other`. | В разделе сделок помечено как `create: true`, список значений задан, но поле не создано в портале. | Для упрощённой модели достаточно использовать стандартное `UTM_MEDIUM` (строка) и нормализовать его роботами без нового списка. |
| `UF_CRM_UIS_UTM_SOURCE` → `UTM_SOURCE` (std) | Планируется хранить конкретный источник. | В сделках используется строковое `UIS_UTM_SOURCE`; отдельного нормализованного поля нет. | Заполнять стандартное поле `UTM_SOURCE` из UIS/форм и отказаться от создания `UF_CRM_UTM_SOURCE`. |
| `UF_CRM_CONTACT_METHOD` (list) | 20 значений (Call 8800, WA 1182, Instagram и т.д.) | В портале уже есть 18 значений; требуется ревизия и дополнение списком из чек-листа. | Добавить недостающие варианты и переименовать к единому виду. |
| `UF_CLIENT_TYPE` (list) | Список `Новый/Повторный/Реактивированный`. | Помечено как `create: true` для сделок и контактов — поле отсутствует. | Создать поле, подготовить роботы определения повторности. |
| `UF_RESPONSIBLE_CHANNEL` (list) | Справочник маркетологов (Синицын, Муратова и т.д.). | В сделках и контактах указано `create: true`. | Создать поле и настроить правила назначения ответственных. |
| `UF_LANDING_DOMAIN` (string) | Строка с нормализованным доменом. | Отмечено как `create: true`, данных нет. | Создать поле и заполнять из форм/UIS. |
| `UF_SOURCE_DESCRIPTION`, `UF_TRACKING_NOTES` | Текстовые служебные поля. | Требуются по чек-листу, в выгрузке нет. | Создать для хранения тех. комментариев. |
| Доп. UTM (`UF_CRM_UTM_CAMPAIGN`, `UF_CRM_UTM_CONTENT`, `UF_CRM_UTM_TERM`) | Строковые поля для полной UTM-связки. | Перечислены в чек-листе как «создать». В выгрузке по сделкам присутствует только UIS-версия. | Для упрощения использовать стандартные `UTM_CAMPAIGN/UTM_CONTENT/UTM_TERM`, перенаправив маппинг форм и интеграций без создания новых полей. |

## 2. Наборы значений, требующие дополнения
- **`UF_CRM_CONTACT_METHOD`** — текущие 18 значений нужно сверить с целевым списком (WA 4510, WA 5115, WA 8888, отдельные формы и т.д.). Чек-лист содержит полный набор для унификации. 
- **`UF_RESPONSIBLE_CHANNEL`** — следует подтвердить актуальность списка сотрудников и добавить новых при необходимости.

## 3. Что проверить в интеграциях
1. **Веб-формы**: убедиться, что скрытые поля (`utm_source`, `utm_medium`, `utm_campaign`, `utm_content`, `utm_term`, `referrer`, `landing_url`) добавлены на всех доменах и маппятся на созданные CRM-поля.
2. **UIS webhook**: проверить передачу UTM и номера канала, сопоставление коротких номеров с `UF_CRM_CONTACT_METHOD`, учёт опечатки `UIS_UTM_COMPAIGN`.
3. **ChatApp/OMNI**: валидировать заполнение `UF_CRM_CONTACT_METHOD` для Instagram, Telegram, VK и WhatsApp каналов.
4. **Каталоги**: контролировать заполнение referrer и доменов для партнёрских площадок (НаПоправку, ПроДокторов и др.).

## 4. Логики и автоматизации
- Робот «Определение UTM_MEDIUM» с условиями по GCLID/YCLID, referrer и каналам мессенджеров — требует доработки после создания полей.
- Роботы назначения ответственных по полю кампании/источника (`UF_RESPONSIBLE_CHANNEL`).
- Скрипты автозаполнения UTM в формах (JavaScript) и нормализация домена перед записью.
- Автоопределение типа клиента (`UF_CLIENT_TYPE`) при повторных обращениях.

## 5. Соответствие стратегии
Этапы стратегии (аудит, создание полей, настройка интеграций, автоматизация) остаются актуальными: аудиторский этап в работе, создание полей и интеграции блокируют запуск роботов, поэтому фокус — закрыть GAP из пункта 1 и 3.

## 6. Как максимально упростить модель
- **Опираться на стандартные поля.** `SOURCE_ID` уже присутствует во всех сценариях как основной канал, а стандартные `UTM_*` поля доступны для детализации. Это позволяет избавиться от планов по созданию дублей `UF_CRM_UTM_*` и вести аналитику без расширения структуры.
- **Оставить один обязательный кастом (`UF_CRM_CONTACT_METHOD`).** Поле фиксирует фактический канал связи и используется роботами для уточнения источника и назначения ответственных, поэтому его проще актуализировать, чем выводить из косвенных признаков.
- **Опционально генерировать описание.** Если нужно текстовое пояснение, роботы могут заполнять `UF_SOURCE_DESCRIPTION` на основе комбинации `SOURCE_ID + UTM + контакт-метод`, сохраняя поле скрытым для менеджеров и исключая прочие кастомные сущности.


